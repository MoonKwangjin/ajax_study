{% extends "blog/layout.html" %}

{% block extra_body %}
    <script>
        $(function() {
            var $win = $(window);
            var is_loading = false;
            var current_page = null;
            // 매 화면 스크롤마다 호출

            var load_more =function () {
                 if(!is_loading){
                        var next_page= (current_page || 1)+1;
                        var next_page_url = '?page=' + next_page; // 다음 페이지를 요청하기 위한 URL생성
                        is_loading = true;
                        $.get(next_page_url).
                        done(function(html) {
                            $('#post-list tbody').append(html);
                            current_page = next_page;
                        }).
                        fail(function(xhr, textStatus, error) {
                            console.log(textStatus);
                        }).
                        always(function() {
                            console.log("always");
                            is_loading = false;
                        });
                    }
            };
            $win.scroll(function() {
                // 문서의 끝에 도달했는가?
                var diff = $(document).height() - parseInt($win.height());

                if (diff == Math.round($win.scrollTop())) {
                    console.log("바닥");
                    load_more();
                }
            });
            $('#load_more-btn').click(load_more);
        });
    </script>
{% endblock %}

{%  block content%}
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <table class="table table-bordered table-hover" id="post-list">
                    <tbody>
                    {% include "blog/_post_list.html" %}
                    </tbody>
                </table>
                <a id="load_more-btn" class="btn btn-primary">Load more...</a>
                <hr/>
                <a href="{% url "blog:post_new" %}" class="btn btn-primary">새 글쓰기</a>
            </div>
        </div>
    </div>
{% endblock %}